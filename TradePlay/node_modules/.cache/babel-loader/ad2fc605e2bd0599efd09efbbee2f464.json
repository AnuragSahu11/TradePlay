{"ast":null,"code":"import { Response } from \"miragejs\";\nimport { requiresAuth } from \"../utils/authUtils\";\nimport { v4 as uuid } from \"uuid\";\n/**\n * All the routes related to User Playlists are present here.\n * These are private routes.\n * Client needs to add \"authorization\" header with JWT token in it to access it.\n * */\n\n/**\n * This handler handles getting all user's playlists.\n * send GET Request at /api/user/playlist\n * */\n\nexport const getAllPlaylistsHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  try {\n    if (!user) {\n      return new Response(404, {}, {\n        errors: [\"The email you entered is not Registered. Not Found error\"]\n      });\n    }\n\n    return new Response(200, {}, {\n      playlists: user.playlists\n    });\n  } catch (error) {\n    return new Response(500, {}, {\n      error\n    });\n  }\n};\n/**\n * This handler handles adding playlist to user's playlists.\n * send POST Request at /api/user/playlists\n * body contains {playlist: {title: \"foo\", description:\"bar bar bar\" }}\n * */\n\nexport const addNewPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  if (user) {\n    const {\n      playlist\n    } = JSON.parse(request.requestBody);\n    user.playlists.push({ ...playlist,\n      videos: [],\n      _id: uuid()\n    });\n    return new Response(201, {}, {\n      playlists: user.playlists\n    });\n  }\n\n  return new Response(404, {}, {\n    errors: [\"The email you entered is not Registered. Not Found error\"]\n  });\n};\n/**\n * This handler handles removing videos from user's playlists.\n * send DELETE Request at /api/user/playlists/:playlistId\n * */\n\nexport const removePlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const filteredPlaylists = user.playlists.filter(item => item._id !== playlistId);\n    this.db.users.update({\n      playlists: filteredPlaylists\n    });\n    return new Response(200, {}, {\n      playlists: filteredPlaylists\n    });\n  }\n\n  return new Response(404, {}, {\n    errors: [\"The user you request does not exist. Not Found error.\"]\n  });\n};\n/**\n * This handler handles getting videos from user's playlist.\n * send GET Request at /api/user/playlists/:playlistId\n * */\n\nexport const getVideosFromPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const playlist = user.playlists.find(item => item._id !== playlistId);\n    return new Response(200, {}, {\n      playlist\n    });\n  }\n\n  return new Response(404, {}, {\n    errors: [\"The user you request does not exist. Not Found error.\"]\n  });\n};\n/**\n * This handler handles adding videos from user's playlist.\n * send POST Request at /api/user/playlists/:playlistId\n * body contains {video}\n * */\n\nexport const addVideoToPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const {\n      video\n    } = JSON.parse(request.requestBody);\n    const playlist = user.playlists.find(item => item._id === playlistId);\n\n    if (playlist.videos.some(item => item.id === video.id)) {\n      return new Response(409, {}, {\n        errors: [\"The video is already in your playlist\"]\n      });\n    }\n\n    playlist.videos.push(video);\n    return new Response(201, {}, {\n      playlist\n    });\n  }\n\n  return new Response(404, {}, {\n    errors: [\"The user you request does not exist. Not Found error.\"]\n  });\n};\n/**\n * This handler handles removing videos from user's playlist.\n * send DELETE Request at /api/user/playlists/:playlistId/:videoId\n * */\n\nexport const removeVideoFromPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const videoId = request.params.videoId;\n    let playlist = user.playlists.find(item => item._id === playlistId);\n    const filteredVideos = playlist.videos.filter(item => item._id !== videoId);\n    playlist.videos = filteredVideos;\n    return new Response(200, {}, {\n      playlist\n    });\n  }\n\n  return new Response(404, {}, {\n    errors: [\"The user you request does not exist. Not Found error.\"]\n  });\n};","map":{"version":3,"sources":["C:/My stuff/S/2022 Projects/video library app/TradePlay/TradePlay/src/backend/controllers/PlaylistController.js"],"names":["Response","requiresAuth","v4","uuid","getAllPlaylistsHandler","schema","request","user","call","errors","playlists","error","addNewPlaylistHandler","playlist","JSON","parse","requestBody","push","videos","_id","removePlaylistHandler","playlistId","params","filteredPlaylists","filter","item","db","users","update","getVideosFromPlaylistHandler","find","addVideoToPlaylistHandler","video","some","id","removeVideoFromPlaylistHandler","videoId","filteredVideos"],"mappings":"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","sourcesContent":["import { Response } from \"miragejs\";\nimport { requiresAuth } from \"../utils/authUtils\";\nimport { v4 as uuid } from \"uuid\";\n\n/**\n * All the routes related to User Playlists are present here.\n * These are private routes.\n * Client needs to add \"authorization\" header with JWT token in it to access it.\n * */\n\n/**\n * This handler handles getting all user's playlists.\n * send GET Request at /api/user/playlist\n * */\nexport const getAllPlaylistsHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  try {\n    if (!user) {\n      return new Response(\n        404,\n        {},\n        {\n          errors: [\"The email you entered is not Registered. Not Found error\"],\n        }\n      );\n    }\n    return new Response(200, {}, { playlists: user.playlists });\n  } catch (error) {\n    return new Response(\n      500,\n      {},\n      {\n        error,\n      }\n    );\n  }\n};\n\n/**\n * This handler handles adding playlist to user's playlists.\n * send POST Request at /api/user/playlists\n * body contains {playlist: {title: \"foo\", description:\"bar bar bar\" }}\n * */\n\nexport const addNewPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  if (user) {\n    const { playlist } = JSON.parse(request.requestBody);\n    user.playlists.push({ ...playlist, videos: [], _id: uuid() });\n    return new Response(201, {}, { playlists: user.playlists });\n  }\n  return new Response(\n    404,\n    {},\n    {\n      errors: [\"The email you entered is not Registered. Not Found error\"],\n    }\n  );\n};\n\n/**\n * This handler handles removing videos from user's playlists.\n * send DELETE Request at /api/user/playlists/:playlistId\n * */\n\nexport const removePlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const filteredPlaylists = user.playlists.filter(\n      (item) => item._id !== playlistId\n    );\n    this.db.users.update({ playlists: filteredPlaylists });\n    return new Response(200, {}, { playlists: filteredPlaylists });\n  }\n  return new Response(\n    404,\n    {},\n    { errors: [\"The user you request does not exist. Not Found error.\"] }\n  );\n};\n\n/**\n * This handler handles getting videos from user's playlist.\n * send GET Request at /api/user/playlists/:playlistId\n * */\n\nexport const getVideosFromPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const playlist = user.playlists.find((item) => item._id !== playlistId);\n    return new Response(200, {}, { playlist });\n  }\n  return new Response(\n    404,\n    {},\n    { errors: [\"The user you request does not exist. Not Found error.\"] }\n  );\n};\n\n/**\n * This handler handles adding videos from user's playlist.\n * send POST Request at /api/user/playlists/:playlistId\n * body contains {video}\n * */\n\nexport const addVideoToPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const { video } = JSON.parse(request.requestBody);\n    const playlist = user.playlists.find((item) => item._id === playlistId);\n    if (playlist.videos.some((item) => item.id === video.id)) {\n      return new Response(\n        409,\n        {},\n        {\n          errors: [\"The video is already in your playlist\"],\n        }\n      );\n    }\n    playlist.videos.push(video);\n    return new Response(201, {}, { playlist });\n  }\n  return new Response(\n    404,\n    {},\n    { errors: [\"The user you request does not exist. Not Found error.\"] }\n  );\n};\n\n/**\n * This handler handles removing videos from user's playlist.\n * send DELETE Request at /api/user/playlists/:playlistId/:videoId\n * */\n\nexport const removeVideoFromPlaylistHandler = function (schema, request) {\n  const user = requiresAuth.call(this, request);\n  if (user) {\n    const playlistId = request.params.playlistId;\n    const videoId = request.params.videoId;\n    let playlist = user.playlists.find((item) => item._id === playlistId);\n    const filteredVideos = playlist.videos.filter(\n      (item) => item._id !== videoId\n    );\n    playlist.videos = filteredVideos;\n    return new Response(200, {}, { playlist });\n  }\n  return new Response(\n    404,\n    {},\n    { errors: [\"The user you request does not exist. Not Found error.\"] }\n  );\n};\n"]},"metadata":{},"sourceType":"module"}